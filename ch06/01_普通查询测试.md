
### 测试说明

1. 定义并创建集合 orders，共有文档数量 2010177 条。
2. 集合 orders 中每个文档的结构示例:
  ```json
    {
        "id" : 109393266,
        "serverId" : 10,
        "orderId" : 14734,
        "symbol" : 601636,
        "account" : 10093,
        "type" : 1,
        "status" : 4,
        "submitTime" : 1635471650495.48,
        "closeTime" : 1635471654392.01,
        "acceptTime" : 1635471650505.57,
        "createTime" : 1635471650495.41,
        "orderVolumn" : 200,
        "dealVolumn" : 200,
        "orderPrice" : 161900,
        "orderType" : 1,
        "nTime" : 94050000,
        "tag" : "TEST3",
        "risker" : "TEST3",
        "timeout" : 20000,
        "force" : "f",
        "dealPrice" : 161900,
        "errCode" : "JErrorType_None",
        "errDetail" : "",
        "DRI" : 0,
        "DIO" : 0,
        "DIA" : 0,
        "DAM" : 3883,
        "auto_incr" : 11945932,
        "create_time" : "2021-10-29 09:40:51.574981+08",
        "modify_time" : "2021-10-29 09:40:51.574981+08",
        "available" : "t"
    }
  ```

### 测试环境

- MongoDB: 5.0.5
- 测试环境有两种: VMware-14-Pro/Ubuntu-18.04

### 测试样本

```js
    db.getCollection('orders').explain("executionStats").find({
        $and: [
            { symbol: { $in: [603518, 600876, 605399, 603050] } },
            { status: { $in: [4, 7] } }
        ]
    },{
        _id: 0, id: 1, serverId: 1, orderId: 1, symbol: 1, account: 1, type: 1, status: 1, submitTime: 1, closeTime: 1, acceptTime: 1, nTime: 1
    }).sort({ submitTime: 1, modify_time: -1 }).skip(5000).limit(10);
```
等价于 SQL:
```sql
    SELECT "id","serverId","orderId","symbol","account","type","status","submitTime","closeTime","acceptTime","nTime" FROM tbl_trade_order
        WHERE "symbol" IN ('603518', '600876', '605399', '603050')
                AND "status" IN (4, 7)
            ORDER BY "submitTime" ASC, "modify_time" DESC
                OFFSET 5000 LIMIT 10;
```


### 测试方法

- 在同一个 MongoDB 创建两个库，分别命名为 `online` 和 `offline`，前者作为测试库，后者作为对照库。
- 向两个库中分别写入集合 orders 。
- 为 online.orders 中测试字段创建相关索引，命令如下:
  ```js
    use online
    db.getCollection("orders").createIndex( { symbol: 1 } )
  ```

### 测试记录

VMware-14-Pro/Ubuntu-18.04 机器上 online 与 offline 的测试结果对比:

耗时: 毫秒。

| 名称/耗时 | 第一次 | 第二次 | 第三次 |
|:---------|:-------|:------|:-------|
| 有索引   | 41     | 48    | 41     |
| 无索引   | 2131   | 1972  | 1940   |
| pgsql(未优化) | 195 | 205  | 202    |

### 测试结论

MongoDB 对一些匹配字段设置索引，确实可以提高查询效率。

